<html lang="en">
<head>
    <title>Springboot and Captcha</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://www.google.com/recaptcha/api.js" type="text/javascript"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<script type="text/javascript">
    function validateAndGetCaptchaResponse() {
        const response = grecaptcha.getResponse();
        return response.length === 0 ? null : response;
    }

    $(document).ready(function () {
        $("#button").click(function () {
            $("#captcha-error").html("");

            let captchaResponse = validateAndGetCaptchaResponse();
            if (captchaResponse) {
                console.log("Captcha code accepted.")
                let name = $("#name").val();
                let requestObj = {
                    'name': name.length === 0 ? 'Dummy' : name
                };

                $.ajax({
                    type: "POST",
                    contentType: "application/json",
                    dataType: "json",
                    headers: {
                        "captcha-response": captchaResponse
                    },
                    data: JSON.stringify(requestObj),
                    url: "http://localhost:9001/api/welcome",
                    success: function (data) {
                        alert(data.message);
                    }
                });
            } else {
                $("#captcha-error").html("You cannot leave the captcha code empty.");
            }
        });
    });
</script>


<div class="container-for-all">

    <!-- Video Background -->
    <video class="video-background" id="video-background" loop muted autoplay>
        <source src="../video/Beach_Hotel.mp4"></source>
    </video>

    <div class="overlay">

        <div>
            <h3 style="color: white" >Springboot and Google captcha Application</h3>
            <!-- User input -->
            <label style="color: white" for="name">Enter name:</label>
            <input id="name" placeholder="say... Vitaliy" type="text"/>
            <button id="button" type="submit">Submit</button>

            <div>&nbsp;</div>

            <!-- Google captcha (I'm not robot checkbox) -->
            <!-- SITE_KEY - Represents the site_key generated by the Google reCaptcha service -->
            <div class="g-recaptcha" data-sitekey="6LcbfGIkAAAAAHbVDyAcINmlve0pRqJD0H18nhI8" id="recaptcha"></div>
            <span id="captcha-error" style="color:red"></span>

        </div>
    </div>
</div>
</body>
</html>